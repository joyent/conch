---
$schema: 'http://json-schema.org/draft-07/schema#'
definitions:
  uuid:
    $ref: common.yaml#/definitions/uuid
  relay_id:
    $ref: common.yaml#/definitions/relay_id
  device_id:
    $ref: common.yaml#/definitions/device_id
  device_asset_tag:
    $ref: common.yaml#/definitions/device_asset_tag
  device_phase:
    $ref: common.yaml#/definitions/device_phase
  ipaddr:
    $ref: common.yaml#/definitions/ipaddr
  macaddr:
    $ref: common.yaml#/definitions/macaddr
  email_address:
    $ref: common.yaml#/definitions/email_address
  validation_status:
    type: string
    enum:
      # TODO: remove antiquated 'processing'
      - error
      - fail
      - processing
      - pass
  device_health:
    type: string
    enum:
      - error
      - fail
      - unknown
      - pass
  Error:
    type: object
    additionalProperties: false
    required:
      - error
    properties:
      error:
        type: string
  Ping:
    type: object
    additionalProperties: false
    required:
      - status
    properties:
      status:
        const: ok
  Login:
    type: object
    additionalProperties: false
    required:
      - jwt_token
    properties:
      jwt_token:
        type: string
  DetailedDevice:
    type: object
    additionalProperties: false
    required:
      - id
      - asset_tag
      - created
      - hardware_product
      - health
      - hostname
      - graduated
      - last_seen
      - latest_triton_reboot
      - state
      - system_uuid
      - triton_setup
      - triton_uuid
      - updated
      - uptime_since
      - validated
      - phase
      - location
      - nics
      - disks
      - latest_report_is_invalid
      - latest_report
      - invalid_report
    properties:
      id:
        $ref: /definitions/device_id
      asset_tag:
        oneOf:
          - $ref: /definitions/device_asset_tag
          - type: 'null'
      created:
        type: string
        format: date-time
      hardware_product:
        $ref: /definitions/uuid
      health:
        $ref: /definitions/device_health
      hostname:
        oneOf:
          - type: string
          - type: 'null'
      graduated:
        oneOf:
          - type: string
            format: date-time
          - type: 'null'
      last_seen:
        oneOf:
          - type: string
            format: date-time
          - type: 'null'
      latest_triton_reboot:
        oneOf:
          - type: string
            format: date-time
          - type: 'null'
      state:
        type: string
      system_uuid:
        oneOf:
          - type: 'null'
          - $ref: /definitions/uuid
      triton_setup:
        oneOf:
          - type: string
            format: date-time
          - type: 'null'
      triton_uuid:
        oneOf:
          - $ref: /definitions/uuid
          - type: 'null'
      updated:
        type: string
        format: date-time
      uptime_since:
        oneOf:
          - type: string
            format: date-time
          - type: 'null'
      validated:
        oneOf:
          - type: string
            format: date-time
          - type: 'null'
      phase:
        $ref: /definitions/device_phase
      location:
        oneOf:
          - $ref: /definitions/DeviceLocation
          - type: 'null'
      nics: # NOTE: see also DeviceNic
        type: array
        uniqueItems: true
        items:
          type: object
          additionalProperties: false
          required:
            - mac
            - iface_name
            - iface_vendor
            - peer_mac
            - peer_port
            - peer_switch
          properties:
            mac:
              $ref: /definitions/macaddr
            iface_name:
              type: string
            iface_vendor:
              type: string
            iface_type:
              type: string
            peer_mac:
              oneOf:
                - type: string
                - type: 'null'
            peer_port:
              oneOf:
                - type: string
                - type: 'null'
            peer_switch:
              oneOf:
                - type: string
                - type: 'null'
      disks:
        type: array
        uniqueItems: true
        items:
          type: object
          additionalProperties: false
          required:
            - id
            - serial_number
            - slot
            - size
            - vendor
            - model
            - firmware
            - transport
            - health
            - drive_type
            - temp
            - enclosure
            - created
            - updated
          properties:
            id:
              $ref: /definitions/uuid
            serial_number:
              type: string
            slot:
              oneOf:
                - type: integer
                - type: 'null'
            size:
              oneOf:
                - type: integer
                - type: 'null'
            vendor:
              oneOf:
                - type: string
                - type: 'null'
            model:
              oneOf:
                - type: string
                - type: 'null'
            firmware:
              oneOf:
                - type: string
                - type: 'null'
            transport:
              oneOf:
                - type: string
                - type: 'null'
            health:
              oneOf:
                - type: string
                - type: 'null'
            drive_type:
              oneOf:
                - type: string
                - type: 'null'
            temp:
              oneOf:
                - type: integer
                - type: 'null'
            enclosure:
              oneOf:
                - type: integer
                - type: 'null'
            hba:
              oneOf:
                - type: integer
                - type: 'null'
            created:
              type: string
              format: date-time
            updated:
              type: string
              format: date-time
      latest_report_is_invalid:
        type: boolean
      latest_report:
        description: the contents of the device report. Given its age we cannot provide a schema.
        anyOf:
          - type: 'null'
          - $ref: device_report.yaml#/definitions/DeviceReport_v2.29
          - type: object  # TODO: remove this loose alternative when we purge historical db records
      invalid_report:
        description: this could be anything, from encoded json to random junk
        oneOf:
          - type: string
          - type: 'null'
  DeviceIds:
    type: array
    uniqueItems: true
    items:
      $ref: /definitions/device_id
  Devices:
    type: array
    uniqueItems: true
    items:
      $ref: /definitions/Device
  Device:
    type: object
    additionalProperties: false
    required:
      - id
      - asset_tag
      - created
      - hardware_product
      - health
      - hostname
      - graduated
      - last_seen
      - latest_triton_reboot
      - state
      - system_uuid
      - triton_uuid
      - updated
      - uptime_since
      - validated
      - triton_setup
      - phase
      - rack_id
      - rack_unit_start
    properties:
      id:
        $ref: /definitions/device_id
      asset_tag:
        oneOf:
          - $ref: /definitions/device_asset_tag
          - type: 'null'
      created:
        type: string
        format: date-time
      hardware_product:
        $ref: /definitions/uuid
      health:
        $ref: /definitions/device_health
      hostname:
        oneOf:
          - type: string
          - type: 'null'
      graduated:
        oneOf:
          - type: string
            format: date-time
          - type: 'null'
      last_seen:
        oneOf:
          - type: string
            format: date-time
          - type: 'null'
      latest_triton_reboot:
        oneOf:
          - type: string
            format: date-time
          - type: 'null'
      state:
        type: string
      system_uuid:
        oneOf:
          - type: 'null'
          - $ref: /definitions/uuid
      triton_uuid:
        oneOf:
          - $ref: /definitions/uuid
          - type: 'null'
      triton_setup:
        oneOf:
          - type: string
            format: date-time
          - type: 'null'
      updated:
        type: string
        format: date-time
      uptime_since:
        oneOf:
          - type: string
            format: date-time
          - type: 'null'
      validated:
        oneOf:
          - type: string
            format: date-time
          - type: 'null'
      phase:
        $ref: /definitions/device_phase
      rack_id:
        oneOf:
          - $ref: /definitions/uuid
          - type: 'null'
      rack_unit_start:
        oneOf:
          - type: integer
          - type: 'null'
  DeviceNics:
    type: array
    uniqueItems: true
    items:
      $ref: /definitions/DeviceNic
  DeviceNic:
    allOf:
      - $ref: /definitions/DeviceNicFields
      - type: object
        required:
          - device_id
          - mac
          - iface_name
          - iface_vendor
          - iface_driver
          - state
          - speed
          - ipaddr
          - mtu
  DeviceNicFields:
    type: object
    additionalProperties: false
    properties:
      device_id:
        $ref: /definitions/device_id
      mac:
        $ref: /definitions/macaddr
      iface_name:
        type: string
      iface_vendor:
        type: string
      iface_type:
        type: string
      iface_driver:
        type: string
      state:
        oneOf:
          - type: string
          - type: 'null'
      speed:
        oneOf:
          - type: string
          - type: 'null'
      ipaddr:
        oneOf:
          - $ref: /definitions/ipaddr
          - type: 'null'
      mtu:
        oneOf:
          - type: integer
          - type: 'null'
  DeviceNicField:
    allOf:
      - $ref: /definitions/DeviceNicFields
      - type: object
        maxProperties: 1
      - not:
          type: object
          required:
            - device_id
  DevicePXE:
    type: object
    additionalProperties: false
    required:
      - id
      - location
      - ipmi
      - pxe
    properties:
      id:
        $ref: /definitions/device_id
      location:
        oneOf:
          - type: 'null'
          - type: object
            additionalProperties: false
            required:
              - datacenter
              - datacenter_room
              - rack
            properties:
              datacenter:
                type: object
                additionalProperties: false
                required:
                  - name
                  - vendor_name
                properties:
                  name:
                    description: datacenter.region
                    type: string
                  vendor_name:
                    description: datacenter.vendor_name
                    oneOf:
                      - type: 'null'
                      - type: string
              datacenter_room:
                type: object
                additionalProperties: false
                required:
                  - az
                  - alias
                  - vendor_name
                properties:
                  az:
                    type: string
                  alias:
                    type: string
                  vendor_name:
                    oneOf:
                      - type: string
                      - type: 'null'
              rack:
                type: object
                additionalProperties: false
                required:
                  - name
                  - rack_unit_start
                properties:
                  name:
                    type: string
                  rack_unit_start:
                    type: integer
      ipmi:
        oneOf:
          - type: 'null'
          - type: object
            additionalProperties: false
            required:
              - mac
              - ip
            properties:
              mac:
                $ref: /definitions/macaddr
              ip:
                oneOf:
                  - type: 'null'
                  - $ref: /definitions/ipaddr
      pxe:
        oneOf:
          - type: 'null'
          - type: object
            additionalProperties: false
            required:
              - mac
            properties:
              mac:
                $ref: /definitions/macaddr
  DevicePhase:
    type: object
    additionalProperties: false
    required:
      - id
      - phase
    properties:
      id:
        $ref: /definitions/device_id
      phase:
        $ref: /definitions/device_phase
  WorkspaceDevicePXEs:
    type: array
    uniqueItems: true
    items:
      type: object
      additionalProperties: false
      required:
        - id
        - location
        - ipmi
        - pxe
      properties:
        id:
          $ref: /definitions/device_id
        location:
          type: object
          additionalProperties: false
          required:
            - datacenter
            - datacenter_room
            - rack
          properties:
            datacenter:
              type: object
              additionalProperties: false
              required:
                - name
                - vendor_name
              properties:
                name:
                  description: datacenter.region
                  type: string
                vendor_name:
                  description: datacenter.vendor_name
                  oneOf:
                    - type: 'null'
                    - type: string
            datacenter_room:
              type: object
              additionalProperties: false
              required:
                - az
                - alias
                - vendor_name
              properties:
                az:
                  type: string
                alias:
                  type: string
                vendor_name:
                  oneOf:
                    - type: string
                    - type: 'null'
            rack:
              type: object
              additionalProperties: false
              required:
                - name
                - rack_unit_start
              properties:
                name:
                  type: string
                rack_unit_start:
                  type: integer
        ipmi:
          oneOf:
            - type: 'null'
            - type: object
              additionalProperties: false
              required:
                - mac
                - ip
              properties:
                mac:
                  $ref: /definitions/macaddr
                ip:
                  oneOf:
                    - type: 'null'
                    - $ref: /definitions/ipaddr
        pxe:
          oneOf:
            - type: 'null'
            - type: object
              additionalProperties: false
              required:
                - mac
              properties:
                mac:
                  $ref: /definitions/macaddr
  DeviceLocation:
    type: object
    additionalProperties: false
    required:
      - datacenter
      - datacenter_room
      - rack
      - rack_unit_start
      - target_hardware_product
    properties:
      datacenter:
        $ref: /definitions/Datacenter
      datacenter_room:
        $ref: /definitions/DatacenterRoomDetailed
      rack:
        $ref: /definitions/Rack
      rack_unit_start:
        type: integer
      target_hardware_product:
        description: Details of the hardware product the device is expected to be based on its current position and the rack layout.
        type: object
        additionalProperties: false
        required:
          - id
          - name
          - alias
          - vendor
        properties:
          id:
            allOf:
              - description: hardware product ID
              - $ref: /definitions/uuid
          name:
            description: Hardware product name
            type: string
          alias:
            description: Hardware product alias
            type: string
          vendor:
            description: Hardware product vendor name
            type: string
  DeviceSetting:
    allOf:
      - $ref: /definitions/DeviceSettings
      - type: object
        maxProperties: 1
  DeviceSettings:
    type: object
    additionalProperties:
      type: string
  HardwareProducts:
    type: array
    uniqueItems: true
    items:
      $ref: /definitions/HardwareProduct
  HardwareProduct:
    type: object
    additionalProperties: false
    required:
      - id
      - name
      - alias
      - prefix
      - hardware_vendor_id
      - generation_name
      - legacy_product_name
      - sku
      - specification
      - hardware_product_profile
      - created
      - updated
    properties:
      id:
        $ref: /definitions/uuid
      name:
        type: string
      alias:
        type: string
      prefix:
        oneOf:
          - type: string
          - type: 'null'
      hardware_vendor_id:
        allOf:
          - description: Hardware product vendor id
          - $ref: /definitions/uuid
      generation_name:
        oneOf:
          - type: string
          - type: 'null'
      legacy_product_name:
        oneOf:
          - type: string
          - type: 'null'
      sku:
        oneOf:
          - type: string
          - type: 'null'
      specification:
        description: json blob of additional data
        oneOf:
          - type: string
          - type: 'null'
      hardware_product_profile:
        oneOf:
          - $ref: /definitions/HardwareProductProfile
          - type: 'null'
      created:
        type: string
        format: date-time
      updated:
        type: string
        format: date-time
  HardwareProductProfile:
    type: object
    additionalProperties: false
    required:
      - id
      - bios_firmware
      - cpu_num
      - cpu_type
      - dimms_num
      - hba_firmware
      - nics_num
      - psu_total
      - purpose
      - rack_unit
      - ram_total
      - sas_hdd_num
      - sas_hdd_size
      - sas_hdd_slots
      - sata_hdd_num
      - sata_hdd_size
      - sata_hdd_slots
      - sata_ssd_num
      - sata_ssd_size
      - sata_ssd_slots
      - sas_ssd_num
      - sas_ssd_size
      - sas_ssd_slots
      - nvme_ssd_num
      - nvme_ssd_size
      - nvme_ssd_slots
      - raid_lun_num
      - usb_num
    properties:
      id:
        $ref: /definitions/uuid
      bios_firmware:
        type: string
      cpu_num:
        type: integer
      cpu_type:
        type: string
      dimms_num:
        type: integer
      hba_firmware:
        oneOf:
          - type: string
          - type: 'null'
      nics_num:
        type: integer
      psu_total:
        oneOf:
          - type: integer
          - type: 'null'
      purpose:
        type: string
      rack_unit:
        type: integer
      ram_total:
        type: integer
      sas_hdd_num:
        oneOf:
          - type: integer
          - type: 'null'
      sas_hdd_size:
        oneOf:
          - type: integer
          - type: 'null'
      sas_hdd_slots:
        oneOf:
          - type: string
          - type: 'null'
      sata_hdd_num:
        oneOf:
          - type: integer
          - type: 'null'
      sata_hdd_size:
        oneOf:
          - type: integer
          - type: 'null'
      sata_hdd_slots:
        oneOf:
          - type: string
          - type: 'null'
      sata_ssd_num:
        oneOf:
          - type: integer
          - type: 'null'
      sata_ssd_size:
        oneOf:
          - type: integer
          - type: 'null'
      sata_ssd_slots:
        oneOf:
          - type: string
          - type: 'null'
      sas_ssd_num:
        oneOf:
          - type: integer
          - type: 'null'
      sas_ssd_size:
        oneOf:
          - type: integer
          - type: 'null'
      sas_ssd_slots:
        oneOf:
          - type: string
          - type: 'null'
      nvme_ssd_num:
        oneOf:
          - type: integer
          - type: 'null'
      nvme_ssd_size:
        oneOf:
          - type: integer
          - type: 'null'
      nvme_ssd_slots:
        oneOf:
          - type: string
          - type: 'null'
      raid_lun_num:
        oneOf:
          - type: integer
          - type: 'null'
      usb_num:
        type: integer
  WorkspaceRackSummary:
    type: object
    additionalProperties: false
    patternProperties:
      ^[\w-]+$:   # key is a room az name
        type: array
        uniqueItems: true
        items:
          type: object
          additionalProperties: false
          properties:
            id:
              $ref: /definitions/uuid
            name:
              type: string
            phase:
              $ref: common.yaml#/definitions/device_phase
            role: # TODO: this really should be rack_role_id
              type: string
            size:
              type: integer
            device_progress:
              type: object
              additionalProperties: false
              properties:
                # see also device_health
                # TODO: no longer upper-case these in responses
                VALID:
                  type: integer
                PASS:
                  type: integer
                FAIL:
                  type: integer
                UNKNOWN:
                  type: integer
                ERROR:
                  type: integer
  WorkspaceRack:
    type: object
    additionalProperties: false
    required:
      - id
      - name
      - role
      - datacenter
      - phase
      - slots
    properties:
      id:
        $ref: /definitions/uuid
      name:
        type: string
      role: # TODO: this really should be rack_role_id
        type: string
      datacenter:
        description: datacenter room AZ
        type: string
      phase:
        $ref: /definitions/device_phase
      slots:
        type: array
        uniqueItems: true
        items:
          type: object
          additionalProperties: false
          required:
            - id
            - rack_unit_start
            - alias
            - name
            - size
            - vendor
            - occupant
          properties:
            id:
              allOf:
                - description: Hardware product ID
                - $ref: /definitions/uuid
            rack_unit_start:
              description: Starting RU slot position
              type: integer
            alias:
              description: Hardware product alias
              type: string
            name:
              description: Hardware product name
              type: string
            size:
              description: Number of RUs for slot
              type: integer
            vendor:
              description: Hardware product vendor
              type: string
            occupant:
              description: Device assigned to this slot, if any
              oneOf:
                - $ref: /definitions/Device
                - type: 'null'
  WorkspaceRackLayoutUpdateResponse:
    type: object
    additionalProperties: false
    required:
      - updated
    properties:
      updated:
        type: array
        uniqueItems: true
        minItems: 1
        items:
          description: device_id
          type: string
          pattern: ^[\w-]+$
  Validations:
    type: array
    items:
      $ref: /definitions/Validation
  Validation:
    type: object
    additionalProperties: false
    required:
      - id
      - name
      - version
      - description
      - created
      - updated
      - deactivated
    properties:
      id:
        $ref: /definitions/uuid
      name:
        type: string
      version:
        type: number
      description:
        type: string
      created:
        type: string
        format: date-time
      updated:
        type: string
        format: date-time
      deactivated:
        oneOf:
          - type: 'null'
          - type: string
            format: date-time
  ValidationPlans:
    type: array
    uniqueItems: true
    items:
      $ref: /definitions/ValidationPlan
  ValidationPlan:
    type: object
    additionalProperties: false
    required:
      - id
      - name
      - description
      - created
    properties:
      id:
        $ref: /definitions/uuid
      name:
        type: string
      description:
        type: string
      created:
        type: string
        format: date-time
  ValidationResult:
    type: object
    additionalProperties: false
    required:
      - id
      - category
      - component_id
      - device_id
      - hardware_product_id
      - hint
      - message
      - order
      - status
      - validation_id
    properties:
      id:
        oneOf:
          - type: 'null'
          - $ref: /definitions/uuid
      category:
        type: string
      component_id:
        oneOf:
          - type: 'null'
          - type: string
      device_id:
        $ref: /definitions/device_id
      hardware_product_id:
        $ref: /definitions/uuid
      hint:
        oneOf:
          - type: 'null'
          - type: string
      message:
        type: string
      order:
        type: integer
      status:
        $ref: /definitions/validation_status
      validation_id:
        $ref: /definitions/uuid
  ValidationResults:
    type: array
    uniqueItems: true
    items:
      $ref: /definitions/ValidationResult
  ValidationState:
    type: object
    additionalProperties: false
    required:
      - id
      - completed
      - created
      - device_id
      - status
      - validation_plan_id
      - device_report_id
    properties:
      id:
        $ref: /definitions/uuid
      completed:
        oneOf:
          - type: 'null'
          - type: string
            format: date-time
      created:
        type: string
        format: date-time
      device_id:
        $ref: /definitions/device_id
      status:
        $ref: /definitions/validation_status
      validation_plan_id:
        $ref: /definitions/uuid
      device_report_id:
        $ref: /definitions/uuid
  ValidationStatesWithResults:
    type: array
    uniqueItems: true
    items:
      $ref: /definitions/ValidationStateWithResults
  ValidationStateWithResults:
    type: object
    additionalProperties: false
    required:
      - id
      - completed
      - created
      - device_id
      - results
      - status
      - validation_plan_id
      - device_report_id
    properties:
      id:
        $ref: /definitions/uuid
      completed:
        oneOf:
          - type: 'null'
          - type: string
            format: date-time
      created:
        type: string
        format: date-time
      device_id:
        $ref: /definitions/device_id
      results:
        type: array
        uniqueItems: true
        items:
          $ref: /definitions/ValidationResult
      status:
        $ref: /definitions/validation_status
      validation_plan_id:
        $ref: /definitions/uuid
      device_report_id:
        $ref: /definitions/uuid
  ReportValidationResults:
    type: object
    additionalProperties: false
    required:
      - device_id
      - validation_plan_id
      - status
      - results
    properties:
      device_id:
        $ref: /definitions/device_id
      validation_plan_id:
        $ref: /definitions/uuid
      status:
        $ref: /definitions/validation_status
      results:
        $ref: /definitions/ValidationResults
  WorkspaceRelays:
    type: array
    uniqueItems: true
    items:
      type: object
      additionalProperties: false
      required:
        - id
        - alias
        - version
        - ipaddr
        - ssh_port
        - created
        - updated
        - location
        - last_seen
        - num_devices
      properties:
        id:
          $ref: /definitions/relay_id
        alias:
          oneOf:
            - type: string
            - type: 'null'
        version:
          oneOf:
            - type: string
            - type: 'null'
        ipaddr:
          oneOf:
            - $ref: /definitions/ipaddr
            - type: 'null'
        ssh_port:
          oneOf:
            - type: integer
            - type: 'null'
        created:
          type: string
          format: date-time
        updated:
          type: string
          format: date-time
        location:
          description: Last reported location of the relay
          type: object
          additionalProperties: false
          required:
            - rack_id
            - rack_name
            - rack_unit_start
            - role_name
            - az
          properties:
            rack_id:
              $ref: /definitions/uuid
            rack_name:
              type: string
            rack_unit_start:
              type: integer
            role_name:
              type: string
            az:
              type: string
        last_seen:
          type: string
          format: date-time
        num_devices:
          type: integer
  WorkspaceAndRole:
    type: object
    additionalProperties: false
    required:
      - id
      - name
      - description
      - parent_id
      - role
    properties:
      id:
        $ref: /definitions/uuid
      name:
        type: string
      description:
        oneOf:
          - type: string
          - type: 'null'
      parent_id:
        oneOf:
          - $ref: /definitions/uuid
          - type: 'null'
      role:
        type: string
        enum:
          - ro
          - rw
          - admin
      role_via:
        allOf:
          - description: the id of the workspace where the permissions came from
          - $ref: /definitions/uuid
  WorkspacesAndRoles:
    type: array
    uniqueItems: true
    items:
      $ref: /definitions/WorkspaceAndRole
  WorkspaceUsers:
    type: array
    uniqueItems: true
    items:
      type: object
      additionalProperties: false
      required:
        - id
        - name
        - email
        - role
      properties:
        id:
          $ref: /definitions/uuid
        name:
          type: string
        email:
          $ref: /definitions/email_address
        role:
          type: string
        role_via:
          allOf:
            - description: this is the id of the workspace where the permissions came from
            - $ref: /definitions/uuid
  Datacenters:
    type: array
    uniqueItems: true
    items:
      $ref: /definitions/Datacenter
  Datacenter:
    type: object
    additionalProperties: false
    required:
      - id
      - vendor
      - vendor_name
      - region
      - location
      - created
      - updated
    properties:
      id:
        $ref: /definitions/uuid
      vendor:
        type: string
      vendor_name:
        oneOf:
          - type: string
          - type: 'null'
      region:
        type: string
      location:
        type: string
      created:
        type: string
        format: date-time
      updated:
        type: string
        format: date-time
  DatacenterRoomsDetailed:
    type: array
    uniqueItems: true
    items:
      $ref: /definitions/DatacenterRoomDetailed
  DatacenterRoomDetailed:
    type: object
    additionalProperties: false
    required:
      - id
      - az
      - alias
      - vendor_name
      - datacenter
      - created
      - updated
    properties:
      id:
        $ref: /definitions/uuid
      az:
        type: string
      alias:
        type: string
      vendor_name:
        oneOf:
          - type: string
          - type: 'null'
      datacenter:
        allOf:
          - description: datacenter id
          - $ref: /definitions/uuid
      created:
        type: string
        format: date-time
      updated:
        type: string
        format: date-time
  Relays:
    type: array
    uniqueItems: true
    items:
      $ref: /definitions/Relay
  Relay:
    type: object
    additionalProperties: false
    required:
      - id
      - alias
      - created
      - ipaddr
      - ssh_port
      - updated
      - version
    properties:
      id:
        $ref: /definitions/relay_id
      alias:
        oneOf:
          - type: string
          - type: 'null'
      created:
        type: string
        format: date-time
      ipaddr:
        oneOf:
          - $ref: /definitions/ipaddr
          - type: 'null'
      ssh_port:
        oneOf:
          - type: integer
          - type: 'null'
      updated:
        type: string
        format: date-time
      version:
        oneOf:
          - type: string
          - type: 'null'
  Version:
    type: object
    additionalProperties: false
    required:
      - version
    properties:
      version:
        type: string
  Racks:
    type: array
    uniqueItems: true
    items:
      $ref: /definitions/Rack
  Rack:
    type: object
    additionalProperties: false
    required:
      - id
      - name
      - datacenter_room_id
      - role
      - serial_number
      - asset_tag
      - phase
      - created
      - updated
    properties:
      id:
        $ref: /definitions/uuid
      name:
        type: string
      datacenter_room_id:
        $ref: /definitions/uuid
      role: # TODO: this really should be rack_role_id
        $ref: /definitions/uuid
      serial_number:
        oneOf:
          - type: string
          - type: 'null'
      asset_tag:
        oneOf:
          - $ref: /definitions/device_asset_tag
          - type: 'null'
      phase:
        $ref: /definitions/device_phase
      created:
        type: string
        format: date-time
      updated:
        type: string
        format: date-time
  RackRole:
    type: object
    additionalProperties: false
    required:
      - id
      - name
      - rack_size
      - created
      - updated
    properties:
      id:
        $ref: /definitions/uuid
      name:
        type: string
      rack_size:
        type: integer
      created:
        type: string
        format: date-time
      updated:
        type: string
        format: date-time
  RackRoles:
    type: array
    uniqueItems: true
    items:
      $ref: /definitions/RackRole
  RackLayouts:
    type: array
    uniqueItems: true
    items:
      $ref: /definitions/RackLayout
  RackLayout:
    type: object
    additionalProperties: false
    required:
      - id
      - rack_id
      - product_id
      - ru_start
      - created
      - updated
    properties:
      id:
        $ref: /definitions/uuid
      rack_id:
        $ref: /definitions/uuid
      product_id:
        $ref: /definitions/uuid
      ru_start: # TODO: this really should be rack_unit_start
        type: integer
      created:
        type: string
        format: date-time
      updated:
        type: string
        format: date-time
  RackAssignments:
    type: array
    uniqueItems: true
    items:
      $ref: /definitions/RackAssignment
  RackAssignment:
    type: object
    additionalProperties: false
    required:
      - device_id
      - device_asset_tag
      - hardware_product
      - rack_unit_start
      - rack_unit_size
    properties:
      device_id:
        oneOf:
          - $ref: /definitions/device_id
          - type: 'null'
      device_asset_tag:
        oneOf:
          - $ref: /definitions/device_asset_tag
          - type: 'null'
      hardware_product:
        description: name of the hardware_product designated for that slot
        type: string
      rack_unit_start:
        description: Starting RU slot position
        type: integer
      rack_unit_size:
        description: number of slots (expected to be) occupied by the hardware
        type: integer
  NewUser:
    type: object
    additionalProperties: false
    required:
      - id
      - email
      - name
    properties:
      id:
        $ref: /definitions/uuid
      email:
        $ref: /definitions/email_address
      name:
        type: string
  UserError:
    type: object
    additionalProperties: false
    required:
      - error
      - user
    properties:
      error:
        type: string
      user:
        type: object
        additionalProperties: false
        required:
          - id
          - email
          - name
          - created
          - deactivated
        properties:
          id:
            $ref: /definitions/uuid
          email:
            $ref: /definitions/email_address
          name:
            type: string
          created:
            type: string
            format: date-time
          deactivated:
            oneOf:
              - type: string
                format: date-time
              - type: 'null'
  UserDetailed:
    type: object
    additionalProperties: false
    required:
      - id
      - name
      - email
      - created
      - last_login
      - refuse_session_auth
      - force_password_change
      - is_admin
      - workspaces
    properties:
      id:
        $ref: /definitions/uuid
      name:
        type: string
      email:
        $ref: /definitions/email_address
      created:
        type: string
        format: date-time
      last_login:
        oneOf:
          - type: 'null'
          - type: string
            format: date-time
      refuse_session_auth:
        type: boolean
      force_password_change:
        type: boolean
      is_admin:
        type: boolean
      workspaces:
        type: array
        uniqueItems: true
        items:
          $ref: /definitions/WorkspaceAndRole
  UsersDetailed:
    type: array
    uniqueItems: true
    items:
       $ref: /definitions/UserDetailed
  UserSettings:
    type: object
  UserSetting:
    allOf:
      - $ref: /definitions/UserSettings
      - type: object
        maxProperties: 1
  UserTokens:
    type: array
    uniqueItems: true
    items:
      $ref: /definitions/UserToken
  UserToken:
    type: object
    additionalProperties: false
    required:
      - name
      - created
      - last_used
      - expires
    properties:
      name:
        type: string
      created:
        type: string
        format: date-time
      last_used:
        oneOf:
          - type: 'null'
          - type: string
            format: date-time
      expires:
        type: string
        format: date-time
  NewUserToken:
    type: object
    additionalProperties: false
    required:
      - token
      - created
      - last_used
      - expires
      - name
    properties:
      token:
        type: string
      created:
        type: string
        format: date-time
      last_used:
        oneOf:
          - type: 'null'
          - type: string
            format: date-time
      expires:
        type: string
        format: date-time
      name:
        type: string
  HardwareVendor:
    type: object
    additionalProperties: false
    required:
      - id
      - name
      - created
      - updated
    properties:
      id:
        $ref: /definitions/uuid
      name:
        type: string
      created:
        type: string
        format: date-time
      updated:
        type: string
        format: date-time
  HardwareVendors:
    type: array
    uniqueItems: true
    items:
      $ref: /definitions/HardwareVendor
  DeviceTotals:
    type: object
    additionalProperties: false
    required:
      - all
      - compute
      - servers
      - storage
      - switches
    patternProperties:
      .:
        type: array
        uniqueItems: true
        items:
          type: object
          additionalProperties: false
          required:
            - alias
            - health
            - count
          properties:
            alias:
              type: string
            health:
              $ref: /definitions/device_health
            count:
              type: integer
  DeviceTotalsCirconus:
    type: object
    properties:
      storage:
        type: object
        additionalProperties: false
        required:
          - count
        properties:
          count:
            type: integer
      compute:
        type: object
        additionalProperties: false
        required:
          - count
        properties:
          count:
            type: integer
    additionalProperties:  # additional keys will be hardware product aliases
      type: object
      additionalProperties: false
      required:
        - health
        - count
      properties:
        health:
          type: object
          additionalProperties: false
          required:
            - PASS
            - FAIL
            - UNKNOWN
          patternProperties:
            # these are the values of /definitions/device_health, but uppercased.
            # TODO: no longer upper-case these in responses
            ^(PASS|FAIL|UNKNOWN|ERROR)$:
              type: integer
        count:
          type: integer
  DeviceReportRow:
    type: object
    additionalProperties: false
    required:
      - id
      - device_id
      - report
      - created
      - invalid_report
    properties:
      id:
        $ref: /definitions/uuid
      device_id:
        $ref: /definitions/device_id
      report:
        description: the contents of the device report. Given its age we cannot provide a schema.
        oneOf:
          - type: 'null'
          - type: object
      created:
        type: string
        format: date-time
      invalid_report:
        description: this could be anything, from encoded json to random junk
        oneOf:
          - type: string
          - type: 'null'

# vim: set sts=2 sw=2 et :
