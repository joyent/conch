---
definitions:
  non_empty_string:
    type: string
    minLength: 1
  uuid:
    type: string
    pattern: "^[0-9A-Fa-f]{8}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{12}$"
  device_id:
    type: string
    pattern: ^\S+$
  device_asset_tag:
    type: string
    pattern: ^\S+$
  ipaddr:
    anyOf:
      - type: string
        format: ipv4
      - type: string
        format: ipv6
  macaddr:
    type: string
    pattern: "^[0-9A-Fa-f]{2}:[0-9A-Fa-f]{2}:[0-9A-Fa-f]{2}:[0-9A-Fa-f]{2}:[0-9A-Fa-f]{2}:[0-9A-Fa-f]{2}$"
  int_or_stringy_int:
    description: an integer that may be presented as a json string
    anyOf:
      - type: integer
      - type: string
        pattern: "^[0-9]+$"
  DatacenterCreate:
    type: object
    additionalProperties: false
    required:
      - vendor
      - region
      - location
    properties:
      vendor:
        type: string
      region:
        type: string
      vendor_name:
        type: string
      location:
        type: string
  DatacenterUpdate:
    type: object
    additionalProperties: false
    properties:
      id:
        $ref: /definitions/uuid
      vendor:
        type: string
      region:
        type: string
      vendor_name:
        type: string
      location:
        type: string
  DatacenterRoomCreate:
    type: object
    additionalProperties: false
    required:
      - datacenter
      - az
    properties:
      datacenter:
        $ref: /definitions/uuid
      az:
        type: string
      alias:
        type: string
      vendor_name:
        type: string
  DatacenterRoomUpdate:
    type: object
    additionalProperties: false
    properties:
      datacenter:
        $ref: /definitions/uuid
      az:
        type: string
      alias:
        type: string
      vendor_name:
        type: string

  DeviceReport:
    required:
      - bios_version
      - memory
      - processor
      - product_name
      - serial_number
      - state
      - system_uuid
    properties:
      bios_version:
        type: string
      disks:
        type: object
        patternProperties:
          ^\S+$:
            description: device_disk.serial_number
            type: object
            properties:
              slot:
                $ref: /definitions/int_or_stringy_int
              size:
                type: integer
              vendor:
                type: string
              model:
                type: string
              firmware:
                type: string
              transport:
                type: string
              health:
                type: string  # TODO: enum?
              drive_type:
                type: string
              temp:
                # TODO: move to different endpoint
                $ref: /definitions/int_or_stringy_int
              enclosure:
                type: string
              hba:
                type: string
              # any additional fields are not currently used.
      device_type:
        type: string
        enum:
          - server
          - switch
      interfaces:
        # TODO: this is required for servers
        type: object
        patternProperties:
          ^\S+$:
            description: interface name
            type: object
            required:
              - mac
              - product
              - vendor
            properties:
              mac:
                $ref: /definitions/macaddr
              product:
                type: string
              vendor:
                type: string
              state:
                anyOf:
                  - type: string
                  - type: 'null'
              # note: no speed yet?
              ipaddr:
                anyOf:
                  - $ref: /definitions/ipaddr
                  - type: 'null'
              mtu:
                anyOf:
                  - $ref: /definitions/int_or_stringy_int
                  - type: 'null'
              peer_mac:
                anyOf:
                  - $ref: /definitions/macaddr
                  - type: 'null'
              # peer_text, peer_switch, peer_port, all optional with no constraints
      media:
        # TODO: this is required for switches
        type: object
        patternProperties:
          ^\S$:
            description: port
            # type: unknown and not used.
      memory:
        type: object
        required:
          - total
          - count
        properties:
          total:
            $ref: /definitions/int_or_stringy_int
          count:
            $ref: /definitions/int_or_stringy_int
      os:
        type: object
        required:
          - hostname
        properties:
          hostname:
            type: string
      processor:
        type: object
        required:
          - type
          - count
        properties:
          type:
            type: string
          count:
            type: integer
      product_name:
        # TODO: required for switches, and also for non-switches when 'sku' is not present.
        type: string
      relay:
        type: object
        required:
          - serial
        properties:
          serial:
            type: string
      serial_number:
        $ref: /definitions/device_id
      state:
        type: string
      system_uuid:
        $ref: /definitions/uuid
      temp:
        # TODO: move to different endpoint
        type: object
        required:
          - cpu0
          - cpu1
        properties:
          cpu0:
            $ref: /definitions/int_or_stringy_int
          cpu1:
            $ref: /definitions/int_or_stringy_int
          exhaust:
            $ref: /definitions/int_or_stringy_int
          inlet:
            $ref: /definitions/int_or_stringy_int
      uptime_since:
        type: string
  RackCreate:
    type: object
    additionalProperties: false
    required:
      - name
      - datacenter_room_id
      - role
    properties:
      name:
        type: string
      datacenter_room_id:
        $ref: /definitions/uuid
      role:
        $ref: /definitions/uuid
  RackUpdate:
    type: object
    additionalProperties: false
    properties:
      name:
        type: string
      datacenter_room_id:
        $ref: /definitions/uuid
      role:
        $ref: /definitions/uuid
      serial_number:
        type: string
      asset_tag:
        type: string
  RackRoleCreate:
    type: object
    additionalProperties: false
    required:
      - name
      - rack_size
    properties:
      name:
        type: string
      rack_size:
        type: integer
  RackRoleUpdate:
    type: object
    additionalProperties: false
    properties:
      name:
        type: string
      rack_size:
        type: integer
  RackLayoutCreate:
    type: object
    additionalProperties: false
    required:
      - rack_id
      - product_id
      - ru_start
    properties:
      rack_id:    # TODO: this really should be datacenter_rack_id
        $ref: /definitions/uuid
      product_id: # TODO: this really should be hardware_product_id
        $ref: /definitions/uuid
      ru_start: # TODO: this really should be rack_unit_start
        type: integer
  RackLayoutUpdate:
    type: object
    additionalProperties: false
    properties:
      rack_id:    # TODO: this really should be datacenter_rack_id
        $ref: /definitions/uuid
      product_id: # TODO: this really should be hardware_product_id
        $ref: /definitions/uuid
      ru_start: # TODO: this really should be rack_unit_start
        type: integer
  WorkspaceRackLayoutUpdate:
    type: object
    additionalProperties: false
    minProperties: 1
    patternProperties:
      ^[\w-]+$:         # device id
        description: rack_unit_start
        type: integer
  DeviceLocationUpdate:
    type: object
    additionalProperties: false
    required:
      - rack_id
      - rack_unit
    properties:
      rack_id:
        $ref: /definitions/uuid
      rack_unit:
        type: integer
  HardwareProductCreate:
    type: object
    additionalProperties: false
    required:
      - name
      - alias
    oneOf:
      - required:
        - hardware_vendor_id
      # old name maintained for backcompat for now. please switch to the full name.
      - required:
        - vendor
    properties:
      name:
        type: string
      alias:
        type: string
      prefix:
        anyOf:
          - type: string
          - type: 'null'
      vendor:
        $ref: /definitions/uuid
      hardware_vendor_id:
        $ref: /definitions/uuid
      specification:
        description: json blob of additional data
        anyOf:
          - type: string
          - type: 'null'
      sku:
        anyOf:
          - type: string
          - type: 'null'
      generation_name:
        anyOf:
          - type: string
          - type: 'null'
      legacy_product_name:
        anyOf:
          - type: string
          - type: 'null'
      hardware_product_profile:
        $ref: /definitions/HardwareProductProfileCreate
  HardwareProductProfileUpdate:
    type: object
    additionalProperties: false
    not:
      required:
        # cannot have zpool_id *and* zpool_profile together.
        - zpool_id
        - zpool_profile
    properties:
      rack_unit:
        type: integer
      purpose:
        type: string
      bios_firmware:
        type: string
      hba_firmware:
        anyOf:
          - type: string
          - type: 'null'
      cpu_num:
        type: integer
      cpu_type:
        type: string
      dimms_num:
        type: integer
      ram_total:
        type: integer
      nics_num:
        type: integer
      sata_num:
        anyOf:
          - type: integer
          - type: 'null'
      sata_size:
        anyOf:
          - type: integer
          - type: 'null'
      sata_slots:
        anyOf:
          - type: string
          - type: 'null'
      sas_num:
        anyOf:
          - type: integer
          - type: 'null'
      sas_size:
        anyOf:
          - type: integer
          - type: 'null'
      sas_slots:
        anyOf:
          - type: string
          - type: 'null'
      ssd_num:
        anyOf:
          - type: integer
          - type: 'null'
      ssd_size:
        anyOf:
          - type: integer
          - type: 'null'
      ssd_slots:
        anyOf:
          - type: string
          - type: 'null'
      psu_total:
        anyOf:
          - type: integer
          - type: 'null'
      usb_num:
        type: integer
      zpool_id:
        anyOf:
          - type: 'null'
          - $ref: /definitions/uuid
      zpool_profile:
        $ref: /definitions/ZpoolProfileCreate
  HardwareProductUpdate:
    type: object
    additionalProperties: false
    required:
      - id
    not:
      required:
        # cannot have hardware_vendor_id *and* vendor together.
        - hardware_vendor_id
        - vendor
    properties:
      id:
        $ref: /definitions/uuid
      name:
        type: string
      alias:
        type: string
      prefix:
        anyOf:
          - type: string
          - type: 'null'
      hardware_vendor_id:
        $ref: /definitions/uuid
      vendor:
        description: for backcompat only.
        $ref: /definitions/uuid
      specification:
        description: json blob of additional data
        anyOf:
          - type: string
          - type: 'null'
      sku:
        anyOf:
          - type: string
          - type: 'null'
      generation_name:
        anyOf:
          - type: string
          - type: 'null'
      legacy_product_name:
        anyOf:
          - type: string
          - type: 'null'
      hardware_product_profile:
        $ref: /definitions/HardwareProductProfileUpdate
  ZpoolProfileCreate:
    type: object
    additionalProperties: false
    properties:
      name:
        anyOf:
          - type: string
          - type: 'null'
      vdev_t:
        anyOf:
          - type: string
          - type: 'null'
      vdev_n:
        anyOf:
          - type: integer
          - type: 'null'
      disk_per:
        anyOf:
          - type: integer
          - type: 'null'
      spare:
        anyOf:
          - type: integer
          - type: 'null'
      log:
        anyOf:
          - type: integer
          - type: 'null'
      cache:
        anyOf:
          - type: integer
          - type: 'null'
  HardwareProductProfileCreate:
    allOf:
      - $ref: /definitions/HardwareProductProfileUpdate
      - required:
        - rack_unit
        - purpose
        - bios_firmware
        - cpu_num
        - cpu_type
        - dimms_num
        - ram_total
        - nics_num
        - usb_num
  Login:
    type: object
    additionalProperties: false
    required:
      - user
      - password
    properties:
      user:
        $ref: /definitions/non_empty_string
      password:
        $ref: /definitions/non_empty_string
  UserPassword:
    type: object
    additionalProperties: false
    required:
      - password
    properties:
      password:
        type: string
  NewUser:
    type: object
    additionalProperties: false
    required:
      - email
    properties:
      name:
        type: string
      email:
        type: string
        format: email
      password:
        type: string
  UpdateUser:
    type: object
    additionalProperties: false
    properties:
      name:
        type: string
      email:
        type: string
        format: email
      is_admin:
        type: boolean
  CreateValidationPlan:
    type: object
    additionalProperties: false
    required:
      - name
      - description
    properties:
      name:
        type: string
      description:
        type: string
  AddValidationToPlan:
    type: object
    additionalProperties: false
    required:
      - id
    properties:
      id:
        $ref: /definitions/uuid
  WorkspaceAddRack:
    type: object
    additionalProperties: false
    required:
      - id
    properties:
      id:
        $ref: /definitions/uuid
      serial_number:
        type: string
      asset_tag:
        type: string
  WorkspaceCreate:
    type: object
    additionalProperties: false
    required:
      - name
    properties:
      name:
        $ref: /definitions/non_empty_string
      description:
        anyOf:
          - type: 'null'
          - $ref: /definitions/non_empty_string
  WorkspaceAddUser:
    type: object
    additionalProperties: false
    required:
      - user
      - role
    properties:
      user:
        type: string
        format: email
      role:
        type: string
        enum:
          - ro
          - rw
          - admin
  DeviceAssetTag:
    type: object
    additionalProperties: false
    required:
      - asset_tag
    properties:
      asset_tag:
        $ref: /definitions/device_asset_tag
  DeviceTritonUuid:
    type: object
    additionalProperties: false
    required:
      - triton_uuid
    properties:
      triton_uuid:
        $ref: /definitions/uuid
  WorkspaceRoomReplace:
    type: array
    uniqueItems: true
    items:
      description: datacenter room ids
      $ref: /definitions/uuid

# vim: set sts=2 sw=2 et :
