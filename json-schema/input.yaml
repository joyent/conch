---
definitions:
  uuid:
    type: string
    pattern: "^[0-9A-Fa-f]{8}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{12}$"
  device_id:
    type: string
    pattern: ^\S+$
  device_asset_tag:
    type: string
    pattern: ^\S+$
  ipaddr:
    anyOf:
      - type: string
        format: ipv4
      - type: string
        format: ipv6
  macaddr:
    type: string
    pattern: "^[0-9A-Fa-f]{2}:[0-9A-Fa-f]{2}:[0-9A-Fa-f]{2}:[0-9A-Fa-f]{2}:[0-9A-Fa-f]{2}:[0-9A-Fa-f]{2}$"
  int_or_stringy_int:
    description: an integer that may be presented as a json string
    anyOf:
      - type: integer
      - type: string
        pattern: "^[0-9]+$"
  DatacenterCreate:
    type: object
    additionalProperties: false
    required:
      - vendor
      - region
      - location
    properties:
      vendor:
        type: string
      region:
        type: string
      vendor_name:
        type: string
      location:
        type: string
  DatacenterUpdate:
    type: object
    additionalProperties: false
    properties:
      id:
        $ref: /definitions/uuid
      vendor:
        type: string
      region:
        type: string
      vendor_name:
        type: string
      location:
        type: string
  DatacenterRoomCreate:
    type: object
    additionalProperties: false
    required:
      - datacenter
      - az
    properties:
      datacenter:
        $ref: /definitions/uuid
      az:
        type: string
      alias:
        type: string
      vendor_name:
        type: string
  DatacenterRoomUpdate:
    type: object
    additionalProperties: false
    properties:
      datacenter:
        $ref: /definitions/uuid
      az:
        type: string
      alias:
        type: string
      vendor_name:
        type: string

  DeviceReport:
    type: object
    required:
      - bios_version
      - memory
      - processor
      - product_name
      - serial_number
      - state
      - system_uuid
    properties:
      bios_version:
        type: string
      cpus:
        type: array
        uniqueItems: true
        items:
          type: object
      dimms:
        type: array
        uniqueItems: true
        items:
          type: object
          required:
            - memory-locator
          properties:
            memory-locator:
              type: string
            memory-serial-number:
              type: string
      disks:
        type: object
        patternProperties:
          ^\S+$:
            description: device_disk.serial_number
            type: object
            properties:
              slot:
                $ref: /definitions/int_or_stringy_int
              size:
                type: integer
              vendor:
                type: string
              model:
                type: string
              firmware:
                type: string
              transport:
                type: string
              health:
                type: string  # TODO: enum?
              drive_type:
                type: string
              temp:
                $ref: /definitions/int_or_stringy_int
              enclosure:
                type: string
              hba:
                type: string
              # any additional fields are not currently used.
      device_type:
        type: string
        enum:
          - server
          - switch
      interfaces:
        # TODO: this is required for servers
        type: object
        patternProperties:
          ^\S+$:
            description: interface name
            type: object
            required:
              - mac
              - product
              - vendor
            properties:
              mac:
                $ref: /definitions/macaddr
              product:
                type: string
              vendor:
                type: string
              state:
                anyOf:
                  - type: string
                  - type: 'null'
              # note: no speed yet?
              ipaddr:
                anyOf:
                  - $ref: /definitions/ipaddr
                  - type: 'null'
              mtu:
                anyOf:
                  - $ref: /definitions/int_or_stringy_int
                  - type: 'null'
              peer_mac:
                anyOf:
                  - $ref: /definitions/macaddr
                  - type: 'null'
              # peer_text, peer_switch, peer_port, all optional with no constraints
      media:
        # TODO: this is required for switches
        type: object
        patternProperties:
          ^\S$:
            description: port
            # type: unknown and not used.
      memory:
        type: object
        required:
          - total
          - count
        properties:
          total:
            $ref: /definitions/int_or_stringy_int
          count:
            $ref: /definitions/int_or_stringy_int
      os:
        type: object
        required:
          - hostname
        properties:
          hostname:
            type: string
      processor:
        type: object
        required:
          - type
          - count
        properties:
          type:
            type: string
          count:
            type: integer
      product_name:
        # TODO: required for switches, and also for non-switches when 'sku' is not present.
        type: string
      relay:
        type: object
        required:
          - serial
        properties:
          serial:
            type: string
      serial_number:
        $ref: /definitions/device_id
      state:
        type: string
      system_uuid:
        $ref: /definitions/uuid
      temp:
        type: object
        required:
          - cpu0
          - cpu1
        properties:
          cpu0:
            $ref: /definitions/int_or_stringy_int
          cpu1:
            $ref: /definitions/int_or_stringy_int
          exhaust:
            $ref: /definitions/int_or_stringy_int
          inlet:
            $ref: /definitions/int_or_stringy_int
      uptime_since:
        type: string
  RackCreate:
    type: object
    additionalProperties: false
    required:
      - name
      - datacenter_room_id
      - role
    properties:
      name:
        type: string
      datacenter_room_id:
        $ref: /definitions/uuid
      role:
        $ref: /definitions/uuid
  RackUpdate:
    type: object
    additionalProperties: false
    properties:
      name:
        type: string
      datacenter_room_id:
        $ref: /definitions/uuid
      role:
        $ref: /definitions/uuid
      serial_number:
        type: string
      asset_tag:
        type: string
  RackRoleCreate:
    type: object
    additionalProperties: false
    required:
      - name
      - rack_size
    properties:
      name:
        type: string
      rack_size:
        type: integer
  RackRoleUpdate:
    type: object
    additionalProperties: false
    properties:
      name:
        type: string
      rack_size:
        type: integer
  RackLayoutCreate:
    type: object
    additionalProperties: false
    required:
      - rack_id
      - product_id
      - ru_start
    properties:
      rack_id:    # TODO: this really should be datacenter_rack_id
        $ref: /definitions/uuid
      product_id: # TODO: this really should be hardware_product_id
        $ref: /definitions/uuid
      ru_start: # TODO: this really should be rack_unit_start
        type: integer
  RackLayoutUpdate:
    type: object
    additionalProperties: false
    properties:
      rack_id:    # TODO: this really should be datacenter_rack_id
        $ref: /definitions/uuid
      product_id: # TODO: this really should be hardware_product_id
        $ref: /definitions/uuid
      ru_start: # TODO: this really should be rack_unit_start
        type: integer
  WorkspaceRackLayoutUpdate:
    type: object
    additionalProperties: false
    minProperties: 1
    patternProperties:
      ^[\w-]+$:         # device id
        description: rack_unit_start
        type: integer
  DeviceLocationUpdate:
    type: object
    additionalProperties: false
    required:
      - rack_id
      - rack_unit
    properties:
      rack_id:
        $ref: /definitions/uuid
      rack_unit:
        type: integer
  DBHardwareProductCreate:
    type: object
    additionalProperties: false
    required:
      - name
      - alias
      - vendor
    properties:
      name:
        type: string
      alias:
        type: string
      prefix:
        type: string
      vendor:
        $ref: /definitions/uuid
      specification:
        type: string
      sku:
        type: string
      generation_name:
        type: string
      legacy_product_name:
        type: string
  DBHardwareProductUpdate:
    type: object
    additionalProperties: false
    required:
      - id
    properties:
      id:
        $ref: /definitions/uuid
      name:
        type: string
      alias:
        type: string
      prefix:
        type: string
      vendor:
        $ref: /definitions/uuid
      specification:
        type: string
      sku:
        type: string
      generation_name:
        type: string
      legacy_product_name:
        type: string
  Login:
    type: object
    additionalProperties: false
    required:
      - user
      - password
    properties:
      user:
        type: string
      password:
        type: string
  UserPassword:
    type: object
    additionalProperties: false
    required:
      - password
    properties:
      password:
        type: string
  NewUser:
    type: object
    additionalProperties: false
    required:
      - email
    properties:
      name:
        type: string
      email:
        type: string
        format: email
      password:
        type: string
  UpdateUser:
    type: object
    additionalProperties: false
    properties:
      name:
        type: string
      email:
        type: string
        format: email
      is_admin:
        type: boolean
  CreateValidationPlan:
    type: object
    additionalProperties: false
    required:
      - name
      - description
    properties:
      name:
        type: string
      description:
        type: string
  AddValidationToPlan:
    type: object
    additionalProperties: false
    required:
      - id
    properties:
      id:
        $ref: /definitions/uuid
  WorkspaceAddRack:
    type: object
    additionalProperties: false
    required:
      - id
    properties:
      id:
        $ref: /definitions/uuid
      serial_number:
        type: string
      asset_tag:
        type: string
  WorkspaceCreate:
    type: object
    additionalProperties: false
    required:
      - name
    properties:
      name:
        type: string
      description:
        anyOf:
          - type: 'null'
          - type: string
  WorkspaceAddUser:
    type: object
    additionalProperties: false
    required:
      - user
      - role
    properties:
      user:
        type: string
        format: email
      role:
        type: string
        enum:
          - ro
          - rw
          - admin
  DeviceAssetTag:
    type: object
    additionalProperties: false
    required:
      - asset_tag
    properties:
      asset_tag:
        $ref: /definitions/device_asset_tag
  DeviceTritonUuid:
    type: object
    additionalProperties: false
    required:
      - triton_uuid
    properties:
      triton_uuid:
        $ref: /definitions/uuid
  WorkspaceRoomReplace:
    type: array
    items:
      description: datacenter room ids
      $ref: /definitions/uuid

# vim: set sts=2 sw=2 et :
